{% extends "base.html" %}
{% load dataset_tags %}
{% load url from future %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% block page_title %}sepal | {{ dataset.name }}{% endblock page_title %}
{# Include DataTables base css and jss and plugins #}
{% block static %}
{% include "base/soundmanager_static.html" %}
{% endblock static %}

{% block content %}
<div class="container-fluid">
  <div class="row-fluid">
    <div class="span2">
      {% include "datasets/sidebar.html" %}
    </div><!-- end span2 -->

    <div class="span10">
      {# Dataset control buttons #}
      <div class="btn-toolbar ">
        <div class="pull-right">
          <a id="delete_dataset_{{ dataset.pk }}" href="#delete_dataset_{{ dataset.pk }}_confirm" data-id="{{ dataset.pk }}" class="delete-confirm btn btn-red"><i class="icon-trash icon-white"></i></a>
        </div>
      </div><!-- end btn-toolbar -->
      
      <h2 class="page-title">
        <a href="#" id="dataset-name">{{ dataset.name }}</a>
      </h2>


      {# Information block #}
      <div class="row-fluid m-fluid">
        <div class="m-widget span12">
          <div id="info" class="m-widget-body collapse in">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <th width="20">Description</th>
                  <td><a href="#" id="dataset-description">{{ dataset.description }}</a></td>
                </tr>
                <tr>
                  <th width="20">Species</th>
                  <td class="species"><a href="#" id="dataset-species">{{ dataset.species }}</a></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div><!-- end Information row-fluid-->

      {# Visualization #}
      <div class="row-fluid m-fluid">
        {# Visualization panel #}
        <div id="visualization" class="span5">
          <div class="m-widget">
            <div id="visualization-heading" class="m-widget-header" href="#chart">
              <h3>Figure</h3>
            </div>
            <div class="m-widget-body">
              <div id="chart"></div>
            </div>

          </div>
        </div><!-- end span4 -->
        {# Data table #}
        <div id="dataset" class="span7">
          {% include "datasets/show_dataset.html" %}
        </div><!-- end span8 -->
      </div><!-- end row-fluid -->

      <div class="row-fluid m-fluid">
        <div class="span12">{% include "uploader/upload_form.html" %}</div>
      </div>
    </div>
  </div>
</div>
{# Include modal confirm dialogs #}
{% include "datasets/confirm_delete_dataset.html" %}

{% endblock content %}

{% block scripts %}

{# create a global JS Dataset object so that the Django context variables can be accessed from external JS files #}
<script>
var Dataset = {
  'id': {{ dataset.pk }},
  'updateVisualizationUrl': "{% url 'datasets:load_data' dataset.pk %}",
}
{% if is_empty %}
  Dataset.isEmpty = true;
{% else %}
  Dataset.isEmpty = false;
{% endif %}

$('.instance-label').on('hidden', function(e, reason){
  if(reason === 'save' || reason === 'cancel') {
    // auto-open next editable label
    $(this).closest('tr').next().find('.editable').editable('show');
  }
});
</script>
{# Include visualization script #}
<script src='{{ STATIC_URL }}js/vis.js'></script>

{# Include DataTables scripts #}
{% include "datasets/datatable_init.html" %}

{# Include script to make fields editable #}
{% include "datasets/dataset_editable.html" %}
{% endblock scripts %}
