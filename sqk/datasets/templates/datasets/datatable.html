{% load url from future %}
<script>
/* Get the rows which are currently selected */
var oTable;
$(document).ready(function() {
  var last_column = {{ feature_names|length }} + {{ label_names|length }} + 2;
  var initial_display_length = 10;
  /* Add/remove class to a row when clicked on */
  $('#dataset-table tr').click( function() {
    $(this).toggleClass('info');
  } );

    /* Add a click handler for the delete row */
    $('#delete_rows').click( function() {
        var selected = fnGetSelected( oTable );
        // Remove selected from table
        $.ajax({
          url: "{% url 'datasets:delete_instances' dataset.pk %}",
          type: "POST",
          data: {"selected": get_selected_ids(selected)},
          dataType: 'json',
          // On success, delete the selected rows 
          success: function(data){
            $.each(selected, function(index, value){
              oTable.fnDeleteRow( selected[index] );
            });
          }
        });
    } );

    // Initialize dataset as a DataTable
    try{
      oTable = $('#dataset-table').dataTable( {
      "iDisplayLength": initial_display_length,
      // FIXME: should start on last page
      // "iDisplayStart": {{ data|length }} - initial_display_length-1, // Start on last page
      "bFilter": true, // Disable search
      "aoColumnDefs": [
          // First column should not be sortable
          { 'bSortable': false, 'aTargets': [ 0 ] }
          ]
        } );
    }catch(ex){
      console.log('Caught exception when initializing dataset:');
      console.log(ex);
      console.log('but the show must go on...')
    }
  });

function fnGetSelected( oTableLocal )
{
    return oTableLocal.$('tr.info');
}

function get_selected_ids( selected )
{
  return jQuery.map(selected, function(element) { return jQuery(element).data('id'); });
}
</script>