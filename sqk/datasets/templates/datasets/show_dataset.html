{% load url from future %}
<div class="block span12">
  <div id="datasetHeading" class="block-heading" data-toggle="collapse" href="#dataset">Data</div>
  <div id="dataset" class="collapse in">
    <table id="dataset-table" class="table table-striped table-bordered">
      {# Header #}
      <thead>
        <tr>
          <th rowspan="2">#</th>
          {% if dataset.instances.all %}
          {% for label_name in label_names %}
          <th rowspan="2"><a href="#" class="label_name" id="label_name{{ label_name.pk }}">{{ label_name|title }}</a></th>
          <script>
            $('#label_name{{ label_name.pk }}').editable({
             type: 'text',
             pk: {{ label_name.pk }},
             url: '{% url 'datasets:update_label_name' dataset.pk label_name.pk  %}',
             title: 'Edit label name'
           });
          </script>
          {% endfor %}
          <th colspan="{{ feature_names|length }}" rowspan="1">Audio features</th>
        </tr>
        <tr>
          {% for feature_name in feature_names %}
          <th>{{ feature_name|title }}&nbsp;&nbsp;</th>
          {% endfor %}
          <th>Date added</th>
          <th></th>
          {% endif %}
        </tr>
      </thead>

      {# Data #}
      {# TODO: add ability to select instances #}
      <tbody>
        {% for inst in data %}
          <tr>
            <td>{{ forloop.counter }}</td>

            {% if inst.labels %}
            {% for label_name, label_value in inst.labels.items %}
            <td><a href="#" id="instance_label_{{ inst.pk }}">{{ label_value|title }}</a></td>
            {# Initiate editable label value #}
            <script>
            $('#instance_label_{{ inst.pk }}').editable({
             type: 'text',
             pk: {{ inst.pk }},
             url: '{% url 'datasets:update_instance_label' inst.pk label_name.pk  %}',
             value: '',
             title: 'Edit instance label'
           });
            </script>
            {% endfor %}
            {% else %}
            <td>No label</td>
            {% endif %}
            {% for value in inst.values %}
            <td>{{ value|floatformat:3 }}</td>
            {% endfor %}
            <td>{{ inst.created_at|date:"m/d/Y f a" }}</td>
            <td><a href="{% url 'datasets:instance_delete' dataset.pk inst.pk %}"><i class="icon-remove"></i></a>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
