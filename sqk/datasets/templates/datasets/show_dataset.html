{% load url from future %}
<div class="block span12">
  <div id="datasetHeading" class="block-heading" data-toggle="collapse" href="#dataset">Data</div>
  <div id="dataset" class="collapse in">
    <table id="dataset-table" cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered">
      {# Header #}
      <thead>
        <tr>
          <th>#</th>
          {% if dataset.instances.all %}
          {% for label_name, label_value in dataset.last_instance.labels.items %}
          <th><a href="#" class="label_name" id="label_name{{ label_name.pk }}">{{ label_name|title }}</a></th>
          <script>
            $('#label_name{{ label_name.pk }}').editable({
             type: 'text',
             pk: {{ label_name.pk }},
             url: '{% url 'datasets:update_label_name' dataset.pk label_name.pk  %}',
             title: 'Edit label name'
           });
          </script>
          {% endfor %}
          {% endif %}

          {% for feature_name in feature_names %}
          <th>{{ feature_name|title }}</th>
          {% endfor %}
        </tr>
      </thead>

      {# Data #}
      {# TODO: add ability to select instances #}
      <tbody>
        {% for inst in dataset.sorted_instances.all %}
        <tr>
          <td>{{ forloop.counter }}</td>

          {% if inst.labels %}
          {% for label_name, label_value in inst.labels.items %}
          <td><a href="#" id="instance_label_{{ inst.pk }}">{{ label_value|title }}</a></td>
          <script>
          $('#instance_label_{{ inst.pk }}').editable({
           type: 'text',
           pk: {{ inst.pk }},
           url: '{% url 'datasets:update_instance_label' inst.pk label_name.pk  %}',
           value: '',
           title: 'Edit instance label'
         });
          </script>
          {% endfor %}
          {% else %}
          <td>No label</td>
          {% endif %}
          {% for value in inst.values_as_list %}
          <td>{{ value|floatformat:3 }}</td>
          {% endfor %}
          <td><a href="{% url 'datasets:instance_delete' dataset.pk inst.pk %}"><i class="icon-remove"></i></a>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
