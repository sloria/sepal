{% load url from future %}
<div class="m-widget span12">
  <div id="dataset-heading" class="m-widget-header"><h3>Table</h3></div>
  <div id="m-widget-body" class="block-body">
    <table cellpadding="0" cellspacing="0" border="0" id="dataset-table" class="table table-striped">
      {# Header #}
      <thead>
        <tr>
          {# Only show header if there are instances #}
          {% if not is_empty %}
          <th class="fixed-col" rowspan="1">#</th>
          <th class="fixed-col" rowspan="1"></th>
          
          {% for label_name in label_names %}
          <th rowspan="1"><i class="icon-beaker"></i><a href="#" class="label_name" id="label_name{{ label_name.pk }}"> {{ label_name|capfirst }}</a></th>
          <script>
          $('#label_name{{ label_name.pk }}').editable({
           type: 'text',
           showbuttons: false,
           pk: {{ label_name.pk }},
           url: '{% url 'datasets:update_label_name' dataset.pk label_name.pk  %}',
           value: '',
           title: 'Edit label name'
         });
          </script>
          {% endfor %}
          {% for feature in feature_objects %}
          <th>{{ feature.display_name }} 
              {% if feature.unit %}
              ({{ feature.unit }})
              {% endif %}
          </th>
          {% endfor %}
          <th>File</th>
          <th>Date added</th>
          <th></th>
          {% endif %}
        </tr>
      </thead>

      {# Data #}
      <tbody>
        {% for inst in data %}
        <tr data-id="{{ inst.pk }}" data-row="{{ forloop.counter }}">
          {# Index #}
          {# This will be dynamically drawn at DataTable initialization #}
          <td></td>

          {# Play button #}
          <td class="fixed-col">
            {% if inst.audio_url %}
            <a href="{{ inst.audio_url }}" class="sm2_button">{{ inst.pk }}</a>
            {% endif %}
          </td>


          {# Variable value #}
          {% if inst.labels %}
          {% for label_name, label_value in inst.labels.items %}
          <td><a href="#" class="instance-label" data-id="{{ inst.pk }}" data-value="{{ label_value }}">{{ label_value }}</a></td>
          {# Initiate editable label value #}
          <script>
          $(".instance-label[data-id={{ inst.pk }}]").editable({
           type: 'text',
           showbuttons: false,
           pk: {{ inst.pk }},
           url: "{% url 'datasets:update_instance_label' dataset.pk inst.pk label_name.pk  %}",
           value: '',
           title: 'Edit instance label',
           success: function(data, new_label){
              Viz.reloadData();
          }
          });
          </script>
          {% endfor %}
          {% else %}
          <td>No label</td>
          {% endif %}
          
          {# Values #}
          {% for value in inst.values %}
          <td>{{ value|floatformat:-6 }}</td>
          {% endfor %}
          
          {# File #}
          <td>
            {% if inst.audio_url %}
            <a href="{{ inst.audio_url }}">{{ inst.audio_filename }}</a>
            {% endif %}
          </td>

          {# Created at #}
          <td>{{ inst.created_at|date:"m/d/Y f a" }}</td>

          {# Delete #}
          <td><a href="{% url 'datasets:single_instance_delete' dataset.pk inst.pk %}"><i class="icon-remove"></i></a></td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>